<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="account.js"></script>
    <link rel="Shortcut Icon" type="image/x-icon" href="assets/Provisioner_Token.ico" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
    <title>Faction Provisioner Portal</title>
  </head>
        <div>
            <table border="1" id="notsure" class="table-striped" style="margin: 0px auto;">
                <tr>
                   <td COLSPAN="4" ID="refreshHint"  align="center">this page will be freshed after 300 sec to get current tp price</td>
                </tr>
                <tr>
                    <td>Faction Provisioner</td><td>WP</td><td>The cheapest items</td><td>Price</td>
                </tr>
            </table>
        </div>
    </body>
</html>
<script>
var timeout = 300;

$(function(){
    var npcInfo = [["Quartermaster Natomi","[&BN4HAAA=]"],["Supplymaster Kani","[&BOAHAAA=]"],["Quartermaster Vec","[&BAgIAAA=]"],
                ["Quartermaster Ival","[&BNUHAAA=]"],["Steward Katren","[&BO8HAAA=]"],["Supplymaster Azzi","[&BN0HAAA=]"],
                ["Scavenger Rakatin","[&BAYIAAA=]"],["Forager Polly","[&BAIIAAA=]"],["Supplier Huanya","[&BAwIAAA=]"],
                ["Jatt","[&BAMIAAA=]"],["Supply Assistant","[&BMwHAAA=]"],["Terrill Tinkerclaw","[&BAAIAAA=]"]];
    var itemIDiArray = [[46281,46186,46040,45622,45765,45731],[15465,14469,13924,10702,11876,11121],
                        [15394,14517,13895,10722,11798,11295],[36779,36750,36813,36746,36891,36892],
                        [15508,14596,13974,10710,11835,11248],[38336,38367,38415,38179,38264,38228],
                        [15427,14648,13928,10699,11754,11167],[15352,14566,13895,10722,11798,11295],
                        [15512,14516,13894,10707,11881,11126],[15423,14428,13973,10709,11834,11247],
                        [15391,14563,13976,10691,11921,11341],[36779,36812,36780,36806,36842,36844]];
    var flattenArray = [].concat.apply([], itemIDiArray).sort();
    var unduplicatedArray = Array.from(new Set(flattenArray));
    $.ajax({
      dataType: "json",
      url: "http://api.gw2tp.com/1/items?ids="+itemIDiArray.toString()+"&fields=name,sell,img",
      context: document.body
    }).done(function(data) {
        var itemData = data['results'];
        GG = itemData;
        for(var i = 0;i < itemIDiArray.length;i++)
        {
            switch (i)
            {
                case 0:
                    $("#notsure tr:last").after('<tr><td COLSPAN="4" ID="refreshHint"  align="center">Verdant Brink</td></tr>');
                    break;
                case 5:
                    $("#notsure tr:last").after('<tr><td COLSPAN="4" ID="refreshHint"  align="center">Auric Basin</td></tr>');
                    break;
                case 8:
                    $("#notsure tr:last").after('<tr><td COLSPAN="4" ID="refreshHint"  align="center">Tangled Depths</td></tr>');
                    break;
            }


            var lowestItemPrice = 9999999;
            var lowestitemName = "";
            var itemImage = "";
            for(var j = 0;j < 6;j++)
            {
                var singleItem = itemData[unduplicatedArray.indexOf(itemIDiArray[i][j])];
                if (singleItem[2] < lowestItemPrice)
                {
                    lowestItemPrice = singleItem[2];
                    lowestitemName = singleItem[1];
                    itemImage = singleItem[3];
                }
            }
            var stringPrice = lowestItemPrice.toString();
            var coinedPrice = "";
            var sLength = stringPrice.length;
            if (sLength > 4)
            {
              var gold = stringPrice.substr(0,sLength-4) + "<img src='assets/Gold_coin.png'>";
              coinedPrice += gold;
            }
            if (sLength > 2)
            {
              var silver = stringPrice.substr(sLength-4,2) + "<img src='assets/Silver_coin.png'>";
              coinedPrice += silver;
            }
            var copper = stringPrice.substring(sLength-2,sLength) + "<img src='assets/Copper_coin.png'>";
            coinedPrice += copper;
            lowestitemName = "<a style='color:blue' onClick='copy(\"" + window.btoa(lowestitemName) + "\")' >" + lowestitemName + "</a>";
            $("#notsure tr:last").after('<tr><td>'+npcInfo[i][0]+'</td><td>'+ "<a style='color:blue' onClick='copy(\"" + window.btoa(npcInfo[i][1]) + "\")' >" +npcInfo[i][1]+ "</a>" +'</td><td><img width="10%" height="10%" src="'+itemImage+'">'+lowestitemName+'</td><td>'+coinedPrice+'</td></tr>');
        }
    });
    window.setInterval("refreshThisPage()",1000);
});
function refreshThisPage()
{
    timeout--;
    $("#refreshHint").html("this page will be freshed after "+timeout+" sec to get current tp price");
    if(timeout==0)
    {
        window.location.reload();
    }
}
function copy(s) {
  $('body').append('<textarea id="clip_area"></textarea>');

  var clip_area = $('#clip_area');

  clip_area.text(window.atob(s));
  clip_area.select();

  document.execCommand('copy');

  clip_area.remove();
}
  //made by Leviathan.9385
  //Special thanks my teammates
</script>
